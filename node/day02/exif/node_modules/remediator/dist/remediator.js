!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.remediator=t():n.remediator=t()}(global,function(){return function(n){var t={};function r(e){if(t[e])return t[e].exports;var o=t[e]={i:e,l:!1,exports:{}};return n[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=n,r.c=t,r.d=function(n,t,e){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)r.d(e,o,function(t){return n[t]}.bind(null,o));return e},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.s=3)}([function(n,t){n.exports=require("fs")},function(n,t){n.exports=require("path")},function(n,t,r){var e=r(1),o=r(0),u=parseInt("0777",8);function c(n,t,r,i){"function"==typeof t?(r=t,t={}):t&&"object"==typeof t||(t={mode:t});var s=t.mode,a=t.fs||o;void 0===s&&(s=u&~process.umask()),i||(i=null);var f=r||function(){};n=e.resolve(n),a.mkdir(n,s,function(r){if(!r)return f(null,i=i||n);switch(r.code){case"ENOENT":c(e.dirname(n),t,function(r,e){r?f(r,e):c(n,t,f,e)});break;default:a.stat(n,function(n,t){n||!t.isDirectory()?f(r,i):f(null,i)})}})}n.exports=c.mkdirp=c.mkdirP=c,c.sync=function n(t,r,c){r&&"object"==typeof r||(r={mode:r});var i=r.mode,s=r.fs||o;void 0===i&&(i=u&~process.umask()),c||(c=null),t=e.resolve(t);try{s.mkdirSync(t,i),c=c||t}catch(o){switch(o.code){case"ENOENT":n(t,r,c=n(e.dirname(t),r,c));break;default:var a;try{a=s.statSync(t)}catch(n){throw o}if(!a.isDirectory())throw o}}return c}},function(n,t,r){"use strict";r.r(t);var e={};r.r(e),r.d(e,"BATCH_SIZE_KEY",function(){return v}),r.d(e,"FORMAT_SEPARATOR",function(){return b}),r.d(e,"DEFAULT_BATCH_SIZE",function(){return x}),r.d(e,"DEFAULT_FORMAT",function(){return F}),r.d(e,"DEFAULT_RECURSIVE",function(){return G}),r.d(e,"DEFAULT_SKIP_ERRORS",function(){return k}),r.d(e,"EXIFTOOL_KEY",function(){return H}),r.d(e,"FORMAT_KEY",function(){return j}),r.d(e,"MODE_COPY",function(){return X}),r.d(e,"MODE_DRY",function(){return B}),r.d(e,"MODE_KEY",function(){return J}),r.d(e,"MODE_MOVE",function(){return W}),r.d(e,"DEFAULT_MODE",function(){return Z}),r.d(e,"OUTPUT_DIRECTORY_KEY",function(){return V}),r.d(e,"RECURSIVE_KEY",function(){return q}),r.d(e,"SKIP_ERRORS_KEY",function(){return z}),r.d(e,"SOURCE_DIRECTORIES_KEY",function(){return Q}),r.d(e,"TRANSFORMER_ACTIONS_KEY",function(){return nn}),r.d(e,"TRANSFORMER_NAME_KEY",function(){return tn}),r.d(e,"TRANSFORMER_REPLACE_STRING_KEY",function(){return rn}),r.d(e,"NUMERIC_YEAR",function(){return c}),r.d(e,"NUMERIC_MONTH",function(){return i}),r.d(e,"NUMERIC_MONTH_LEADING_ZERO",function(){return s}),r.d(e,"NUMERIC_DAY",function(){return a}),r.d(e,"NUMERIC_DAY_LEADING_ZERO",function(){return f}),r.d(e,"NUMERIC_HOUR",function(){return E}),r.d(e,"NUMERIC_HOUR_LEADING_ZERO",function(){return d}),r.d(e,"NUMERIC_MINUTE",function(){return l}),r.d(e,"NUMERIC_MINUTE_LEADING_ZERO",function(){return _}),r.d(e,"STRING_MONTH",function(){return p}),r.d(e,"STRING_MONTH_LOWERCASE",function(){return R}),r.d(e,"STRING_MONTH_UPPERCASE",function(){return h}),r.d(e,"STRING_DAY",function(){return O}),r.d(e,"STRING_DAY_LOWERCASE",function(){return T}),r.d(e,"STRING_DAY_UPPERCASE",function(){return M}),r.d(e,"EXTENSION",function(){return I}),r.d(e,"EXTENSION_LOWERCASE",function(){return y}),r.d(e,"EXTENSION_UPPERCASE",function(){return A}),r.d(e,"HEIGHT",function(){return w}),r.d(e,"MAKE",function(){return m}),r.d(e,"MAKE_LOWERCASE",function(){return N}),r.d(e,"MAKE_UPPERCASE",function(){return S}),r.d(e,"MODEL",function(){return D}),r.d(e,"MODEL_LOWERCASE",function(){return $}),r.d(e,"MODEL_UPPERCASE",function(){return g}),r.d(e,"ORIENTATION",function(){return C}),r.d(e,"ORIENTATION_LOWERCASE",function(){return P}),r.d(e,"ORIENTATION_UPPERCASE",function(){return Y}),r.d(e,"WIDTH",function(){return L}),r.d(e,"ALL_TRANSFORMERS",function(){return U}),r.d(e,"RETURN_DATA_OUTPUT_KEY",function(){return An}),r.d(e,"RETURN_DATA_SOURCE_KEY",function(){return wn}),r.d(e,"RETURN_DATA_ERROR_KEY",function(){return mn}),r.d(e,"ATIME_KEY",function(){return en}),r.d(e,"BIRTHTIME_KEY",function(){return on}),r.d(e,"CTIME_KEY",function(){return un}),r.d(e,"MTIME_KEY",function(){return cn}),r.d(e,"EXIF_JPG_CREATE_DATE_KEY",function(){return sn}),r.d(e,"EXIF_JPG_DEVICE_MAKE_KEY",function(){return an}),r.d(e,"EXIF_JPG_DEVICE_MODEL_KEY",function(){return fn}),r.d(e,"EXIF_JPG_MODIFY_DATE_KEY",function(){return En}),r.d(e,"EXIF_JPG_ORIENTATION_KEY",function(){return dn}),r.d(e,"EXIF_JPG_ORIGINAL_DATE_KEY",function(){return ln}),r.d(e,"EXIF_JPG_RESOLUTION",function(){return _n}),r.d(e,"ALL_EXIF_KEYS",function(){return pn}),r.d(e,"LIB_DATE_KEY",function(){return Rn}),r.d(e,"LIB_ERROR_KEY",function(){return hn}),r.d(e,"LIB_MAKE_KEY",function(){return On}),r.d(e,"LIB_MODEL_KEY",function(){return Tn}),r.d(e,"LIB_ORIENTATION_KEY",function(){return Mn}),r.d(e,"LIB_ORIGINAL_FILE_PATH",function(){return In}),r.d(e,"LIB_RESOLUTION_KEY",function(){return yn});var o=r(1),u=r.n(o);const c="YYYY",i="MM",s="MM0",a="DD",f="DD0",E="HH",d="HH0",l="MN",_="MN0",p="Month",R="lcMonth",h="ucMonth",O="Day",T="lcDay",M="ucDay",I="Ext",y="lcExt",A="ucExt",w="Height",m="Make",N="lcMake",S="ucMake",D="Model",$="lcModel",g="ucModel",C="Orientation",P="lcOrientation",Y="ucOrientation",L="Width",U=[c,i,s,a,f,E,d,l,_,p,R,h,O,T,M,I,y,A,w,m,N,S,D,$,g,C,P,Y,L],{sep:K}=u.a,v="batchSize",b=":",x=20,F=`${b}${c}${b}${K}${b}${s}${b}. ${b}${p}${b}${K}${b}${f}${b} ${b}${O}${b}${K}${b}${c}${b}.${b}${s}${b}.${b}${f}${b} ${b}${d}${b}.${b}${_}${b}.${b}${I}${b}`,G=!1,k=!1,H="exiftool",j="format",X="copy",B="dry",J="mode",W="move",Z=B,V="output",q="recursive",z="skipErrors",Q="source",nn="transformerActions",tn="name",rn="replaceString",en="atimeMs",on="birthtimeMs",un="ctimeMs",cn="mtimeMs",sn="CreateDate",an="Make",fn="Model",En="ModifyDate",dn="Orientation",ln="DateTimeOriginal",_n="ImageSize",pn=[sn,an,fn,En,dn,ln,_n],Rn="date",hn="error",On="deviceMake",Tn="deviceModel",Mn="orientation",In="filePath",yn="resolution",An="output",wn="source",mn="error";class Nn extends Error{constructor(n){const t=`Missing required options parameter: ${n}`;super(t),this.message=t,Error.captureStackTrace(this,Nn)}}var Sn=Nn;class Dn extends Error{constructor(n){const t=`The following options parameter is invalid: ${n}`;super(t),this.message=t,Error.captureStackTrace(this,Dn)}}var $n=Dn;class gn extends Error{constructor(n){const t=`Unable to locate, read, or write: ${n}`;super(t),this.message=t,Error.captureStackTrace(this,gn)}}var Cn=gn;class Pn extends Error{constructor(n){const t=`Option "${j}" Missing closing "${b}" in "${n}"`;super(t),this.message=t,Error.captureStackTrace(this,Pn)}}var Yn=Pn;class Ln extends Error{constructor(n){const t=`Transformer missing in ${j}: "${n}"`;super(t),this.message=t,Error.captureStackTrace(this,Ln)}}var Un=Ln;class Kn extends Error{constructor(){const n=`Option "${J}" must only be one of the following: ${X}, ${B}, and ${W}`;super(n),this.message=n,Error.captureStackTrace(this,Kn)}}var vn=Kn;const bn=[H,V,Q];function xn(n){let t;return t=function(n){if(typeof n[H]!=typeof{})throw new $n(H);return{...n}}(t=function(n){if(typeof n[z]!=typeof!0)throw new $n(z);return{...n}}(t=function(n){const t=n[v];if(!Number.isInteger(t))throw new $n(v);return{...n}}(t=function(n){const t=n[J];if(!t||"string"!=typeof t)throw new $n(J);return{...n,[J]:t.toLowerCase()}}(t=function(n){const t=n[j];if(!t||"string"!=typeof t)throw new $n(j);return{...n}}(t=function(n){const t=n[Q],r="string"==typeof t?[t]:t,e=[];if(!Array.isArray(r)||!r.length)throw new $n(Q);return r.forEach(n=>{if("string"!=typeof n||!n.length)throw new $n(Q);e.push(u.a.resolve(n))}),{...n,[Q]:e}}(t=function(n){const t=n[V];if(!t||"string"!=typeof t)throw new $n(V);return{...n,[V]:u.a.resolve(t)}}(t=function(n){if(typeof n[q]!=typeof!0)throw new $n(q);return{...n}}(n))))))))}var Fn=r(0),Gn=r.n(Fn);async function kn(n,t){const r=await function(n){return new Promise((t,r)=>{Gn.a.readdir(n,(n,e)=>{n?r(n):t(e)})})}(n),e=[];Array.from(r,t=>u.a.resolve(n,t)).forEach(n=>e.push(new Promise(r=>{(async function(n){return new Promise((t,r)=>{Gn.a.stat(n,(n,e)=>{n?r(n):t(!!e&&e.isDirectory())})})})(n).then(e=>{if(e)if(t){"."!==n.replace(/^.*[\\/]/,"")[0]?kn(n,t).then(n=>r(n)):r([])}else r([]);else r([n])})})));const o=await Promise.all(e);return[].concat(...o).sort()}var Hn=r(2),jn=r.n(Hn);function Xn(n,t){return new Promise((r,e)=>{const{dir:o}=u.a.parse(t);jn()(o,o=>{o?e(o):Gn.a.copyFile(n,t,n=>{n?e(n):r()})})})}function Bn(n,t){return new Promise((r,e)=>{const{dir:o}=u.a.parse(t);jn()(o,o=>{o?e(o):Gn.a.rename(n,t,n=>{n?e(n):r()})})})}async function Jn(n){const t=[],r=n=>new Promise(async(t,r)=>{try{await function(n){return new Promise((t,r)=>{Gn.a.access(n,Gn.a.constants.F_OK|Gn.a.constants.R_OK|Gn.a.constants.W_OK,n=>{n&&r(n),t(!0)})})}(n),t()}catch(t){r(new Cn(n))}});return t.push(r(n[V])),n[Q].forEach(n=>{t.push(r(n))}),await Promise.all(t),{...n}}const Wn=U.sort((n,t)=>t.length-n.length);async function Zn(n){let t;return function(n){bn.forEach(t=>{if(!Object.prototype.hasOwnProperty.call(n,t))throw new Sn(t)})}(n),t=function(n){switch(n[J]){case X:case B:case W:return{...n};default:throw new vn}}(t=function(n){const t=n[j],r=new RegExp(b,"g"),e=[];if(t.match(r).length%2==1)throw new Yn(t);let o,u=-1;return Array.from(t).forEach((n,r)=>{const c=n===b,i=-1!==u;if(o=c&&i?r:null,u=c&&!i?r:u,i&&o){const n=t.substring(u,o+1),r=Wn.find(t=>-1!==n.indexOf(t));if(!r)throw new Un(n);e.push({[tn]:r,[rn]:n}),u=-1}}),{...n,[nn]:e}}(t=xn(t=function(n){return{[j]:F,[q]:G,[J]:Z,[v]:x,[z]:k,...n}}(n)))),t=await Jn(t)}async function Vn(n){const t=await function(n){return new Promise((t,r)=>{Gn.a.stat(n,(n,e)=>{n?r(n):t(e)})})}(n);return{[en]:t[en],[on]:t[on],[un]:t[un],[cn]:t[cn]}}const qn=[en,on,un,cn],zn=[sn,ln,En];async function Qn(n,t){try{const r=await Vn(t),e=await async function(n,t){const r={},e=n[H],o=await e.read(t,pn);return pn.forEach(n=>{r[n]=o[n]}),r}(n,t),o=new Date(function(n,t){const r=[];return qn.forEach(t=>r.push(n[t])),zn.forEach(n=>{t[n]&&r.push(new Date(t[n]).getTime())}),Math.min(...r)}(r,e));return{[Rn]:o,[On]:e[an],[Tn]:e[fn],[Mn]:e[dn],[In]:t,[yn]:e[_n]}}catch(r){if(n[z])return{[In]:t,[hn]:r};throw r}}function nt(n,t){const r=[];return t.forEach(t=>r.push(Qn(n,t))),Promise.all(r)}function tt(n){const t=n[In].split(".");return t[t.length-1]}function rt(n){return n[On]||""}function et(n){return n[Tn]||""}function ot(n){return n[Rn].getDate()}function ut(n,t){const r=[];for(let e=0;e<n.length;e+=t)r.push(n.slice(e,e+t));return r}function ct(n){return`${n<10?"0":""}${n}`}function it(n){return n[Rn].getHours()}function st(n){return n[Rn].getMinutes()}function at(n){return n[Rn].getMonth()+1}function ft(n){return n[Mn]||""}const Et=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function dt(n){const t=n[Rn].getDay();return Et[t]}const lt=["January","February","March","April","May","June","July","August","September","October","November","December"];function _t(n){const t=at(n);return lt[t-1]}var pt={[I]:tt,[y]:function(n){return tt(n).toLowerCase()},[A]:function(n){return tt(n).toUpperCase()},[w]:function(n){return(n[yn]||"").split("x")[1]||""},[m]:rt,[N]:function(n){return rt(n).toLowerCase()},[S]:function(n){return rt(n).toUpperCase()},[D]:et,[$]:function(n){return et(n).toLowerCase()},[g]:function(n){return et(n).toUpperCase()},[a]:ot,[f]:function(n){return ct(ot(n))},[E]:it,[d]:function(n){return ct(it(n))},[l]:st,[_]:function(n){return ct(st(n))},[i]:at,[s]:function(n){return ct(at(n))},[c]:function(n){return n[Rn].getFullYear()},[C]:ft,[P]:function(n){return ft(n).toLowerCase()},[Y]:function(n){return ft(n).toUpperCase()},[O]:dt,[T]:function(n){return dt(n).toLowerCase()},[M]:function(n){return dt(n).toUpperCase()},[p]:_t,[R]:function(n){return _t(n).toLowerCase()},[h]:function(n){return _t(n).toUpperCase()},[L]:function(n){const t=n[yn]||"",[r]=t.split("x");return r||""}};function Rt(n,t){const r=[];return t.forEach(t=>r.push(function(n,t){const r={[wn]:t[In]};if(t[hn])r[mn]=t[hn];else{let e=n[j];n[nn].forEach(n=>{const r=n[tn],o=pt[r](t);let u="";o&&(u=n[rn].replace(n[tn],o)),e=e.replace(n[rn],u)}),e=e.replace(/:/g,""),r[An]=u.a.join(n[V],e)}return r}(n,t))),r}async function ht(n,t){const r=n[H];let e=[];const o=ut(t,n[v]);for(let t=0;t<o.length;t+=1){const r=o[t],u=Rt(n,await nt(n,r));e=e.concat(u)}return await r.end(),function(n){const t=[...n],r={};for(let n=0;n<t.length;n+=1)if(!t[n][mn]){let e=t[n][An];if(r[e]||Gn.a.existsSync(e)){const{dir:n,ext:t,name:o}=u.a.parse(e);let c=!0;for(let i=1;c;i+=1)r[e=u.a.resolve(n,`${o} (${i})${t}`)]||Gn.a.existsSync(e)||(c=!1),r[e]=!0}r[t[n][An]]=!0,t[n]={...t[n],[An]:e}}return t}(e)}r.d(t,"constants",function(){return e});t.default=async function(n={}){const t=await Zn(n),r=await async function(n,t){const r=[];n.forEach(n=>r.push(new Promise(r=>r(kn(n,t)))));const e=await Promise.all(r);return[].concat(...e).sort()}(t[Q],t[q]),e=await ht(t,r),o=ut(e,t[v]);if(t[J]!==B){const n=t[J]===X?Xn:Bn,r=[];for(let u=0;u<o.length;u+=1)o[u].forEach((o,c)=>r.push(new Promise((r,i)=>{o[mn]?r():n(o[wn],o[An]).then(r).catch(n=>{if(t[z]){const o=u*t[v]+c;e[o]={...e[o],[mn]:n},r()}else i(n)})}))),await Promise.all(r),r.length=0}return e}}])});